function time_filter(a,b,c){return a>b&a<c};function crowdsar(a,b){var c=0,d=0,e=null!=a;if(e)for(i=0;i<a.length;i++)time_filter(a[i].date,b.min_date,b.max_date)&&(d+=1,c+=a[i][b.field]);"mean"==b.metric&&(c/=d);return{value:Math.round(100*c)/100,is_flag:c>=b.threshold,have:e}};function delinquency(a,b){var c=0,d=null!=a;if(d)for(i=0;i<a.length;i++)c+=1==a[i].is_late&a[i].form==b.form&time_filter(a[i].deadline,b.min_date,b.max_date);return{value:c,is_flag:c>=b.threshold,have:d}};function financials(a,b){var c=null!=a,d=0;if(null!=a)for(i=0;i<a.length;i++){var e=a[i].field==b.field;time_filter(a[i].new_date,b.min_date,b.max_date);d+=e}return{value:d,is_flag:c,have:c}};function otc_neighbors(a,b){var c=0,d=!1,e=!1;null!=a&&(c=Math.round(100*a.otc_paths/a.total_paths),d=a.total_paths>=b.number_of_neighbors[0],e=a.total_paths<=b.number_of_neighbors[1]);return{value:d&e?c:-1,is_flag:d&e&c>=b.threshold,have:null!=a}};function suspensions(a,b){var c=0,d=null!=a;if(d)for(i=0;i<a.length;i++)c+=time_filter(a[i].date,b.min_date,b.max_date);return{value:c,is_flag:c>b.threshold,have:d}};function symbology(a,b){var c=0,d=null!=a;if(d)for(i=0;i<a.length;i++)c+=a[i].field==b.field&time_filter(a[i].new_date,b.min_date,b.max_date);return{value:c,is_flag:c>=b.threshold,have:d}};function combine_scores(a,b){var c=0;for(s in a)c+=a[s].is_flag+.01*a[s].value;return c}var functions={symbology:symbology,delinquency:delinquency,otc_neighbors:otc_neighbors,crowdsar:crowdsar,suspensions:suspensions,financials:financials};function run(){var a={};for(k in params)kscore=functions[k](_source[k],params[k]),kscore.have&&(a[k]=kscore);return score?combine_scores(a,params):a}run();