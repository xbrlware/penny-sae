function time_filter(a,c,b){return a>c&a<b}function num_time_filter(a,c,b){return a>Number(c)&a<Number(b)};function crowdsar(a,c,b){var d=a[b+"_stringified"].value;a=null!=d;var e=b=0;if(a)for(d=JSON.parse(d),i=0;i<d.length;i++)time_filter(d[i].date,c.min_date,c.max_date)&&(e+=1,b+=d[i][c.field]);"mean"==c.metric&&(b/=e);return{value:Math.round(100*b)/100,is_flag:b>=c.threshold,have:a}};function delinquency(a,c,b){var d=a[b+"_stringified"].value;a=null!=d;b=0;if(a)for(d=JSON.parse(d),i=0;i<d.length;i++){var e=time_filter(d[i].deadline,c.min_date,c.max_date);b+=1==d[i].is_late&d[i].form==c.form&e}return{value:b,is_flag:b>=c.threshold,have:a}};function financials(a,c,b){var d=a[b+"_stringified"].value;a=null!=d;b=0;if(a)for(d=JSON.parse(d),i=0;i<d.length;i++){var e=time_filter(d[i].date,c.min_date,c.max_date);b+=d[i].field==c.field&e&d[i].value<c.value}return{value:b,is_flag:b>=c.threshold,have:a}};function otc_neighbors(a,c,b){var d=a[b+".otc_paths"].value;a=a[b+".total_paths"].value;b=null!=d;var e=0,f=!1,g=!1;b&&(e=Math.round(100*d/a),f=a>=c.number_of_neighbors[0],g=a<=c.number_of_neighbors[1]);return{value:e,is_flag:f&g&e>=c.threshold,have:b}};function suspensions(a,c,b){a=a["suspensions.date"].value;b=0;var d=null!=a;if(d)for(a=Array.isArray(a)?a:[a],i=0;i<a.length;i++)b+=time_filter(a[i],(new Date(c.min_date)).getTime(),(new Date(c.max_date)).getTime());return{value:b,is_flag:b>c.threshold,have:d}};function symbology(a,c,b){a=a[b+"_stringified"].value;b=null!=a;var d=0;if(b){var e=JSON.parse(a);for(i=0;i<e.length;i++)var f=time_filter(a[i].new_date,c.min_date,c.max_date),d=d+(e[i].field==c.field&f)}return{value:d,is_flag:d>=c.threshold,have:b}};function combine_scores(a,c){var b=0;for(s in a)isNaN(a[s].value)||(b+=a[s].is_flag*(1+.01*a[s].value));return b}var functions={symbology:symbology,delinquency:delinquency,otc_neighbors:otc_neighbors,crowdsar:crowdsar,suspensions:suspensions,financials:financials};function run(){var a={};for(k in params)kscore=functions[k](doc,params[k],k),kscore.have&&(a[k]=kscore);return score?combine_scores(a,params):a}run();